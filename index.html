<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–∏—Å–∫ Telegram –Æ–∑–µ—Ä–æ–≤</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <p class="author">
            –ê–≤—Ç–æ—Ä - **<a href="https://t.me/BIOtvinkov" target="_blank" style="color: var(--secondary-color); text-decoration: none; text-shadow: 0 0 5px var(--shadow-color);">@BIOtvinkov</a>**
        </p>
    </header>

    <main>
        <div class="controls-container">
            <h1>üí¨ –ü–æ–∏—Å–∫ Telegram –Æ–∑–µ—Ä–æ–≤</h1>

            <div class="search-block">
                <input type="text" id="searchInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —é–∑–µ—Ä–Ω–µ–π–º –∏–ª–∏ —á–∞—Å—Ç—å —é–∑–µ—Ä–Ω–µ–π–º–∞...">
                <button id="searchButton">–ù–∞–π—Ç–∏</button>
                <button id="randomButton">–†–∞–Ω–¥–æ–º (20)</button>
            </div>

            <p id="statusMessage"></p>
        </div>

        <div id="resultsContainer">
            </div>
    </main>

    <script>
        // === –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –§–ê–ô–õ–û–í ===
        const TELEGRAM_DB_FILE = 'telegram_all_users.txt'; 
        const RANDOM_COUNT = 20;

        // === –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –ù–∞—á–∞–ª—å–Ω–∞—è –ó–∞–≥—Ä—É–∑–∫–∞ ===
        let allLinks = []; 
        
        const resultsContainer = document.getElementById('resultsContainer');
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const randomButton = document.getElementById('randomButton');
        const statusMessage = document.getElementById('statusMessage');
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è –º–∞—Å—Å–∏–≤–∞ (–¥–ª—è —Ä–∞–Ω–¥–æ–º–∞)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        /**
         * –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–ê–Ø –û–ß–ò–°–¢–ö–ê: –ò–∑–≤–ª–µ–∫–∞–µ—Ç —á–∏—Å—Ç—ã–π —é–∑–µ—Ä–Ω–µ–π–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'username') 
         * –∏–∑ –ª—é–±–æ–π —Å—Ç—Ä–æ–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'https://t.me/@username' –∏–ª–∏ 'Hyper:*@username*:')
         */
        function extractCleanUsername(linkString) {
            // –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram
            // –ò—â–µ—Ç –ª—é–±—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏–º–≤–æ–ª–æ–≤ –ø–æ—Å–ª–µ t.me/ –∏–ª–∏ @, –ø–æ–∫–∞ –Ω–µ –≤—Å—Ç—Ä–µ—Ç–∏—Ç –ø—Ä–æ–±–µ–ª –∏–ª–∏ –¥—Ä—É–≥–æ–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å.
            let match = linkString.match(/(?:t\.me\/|@)([a-zA-Z0-9_]{5,})/i);

            if (match && match[1]) {
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —á–∏—Å—Ç–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                return match[1];
            }
            // –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ —Å—Å—ã–ª–∫–∞, –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ —ç—Ç–æ —É–∂–µ —á–∏—Å—Ç–æ–µ –∏–º—è
            return linkString.trim().replace(/^@/, '');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏ Telegram (href)
        function formatLink(username) {
            const cleanUser = extractCleanUsername(username);
            return `https://t.me/${cleanUser}`;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ .txt —Ñ–∞–π–ª–∞ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º –ø–∞—Ä—Å–∏–Ω–≥–æ–º
        async function loadDatabase() {
            try {
                statusMessage.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Telegram...';
                
                const response = await fetch(TELEGRAM_DB_FILE);
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ ${response.status}: –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Ñ–∞–π–ª ${TELEGRAM_DB_FILE}.`);
                }
                const text = await response.text();
                
                const normalizedText = text.replace(/\r\n/g, '\n'); 

                // –í–ê–ñ–ù–û: –ú—ã –∑–∞–≥—Ä—É–∂–∞–µ–º –°–´–†–´–ï —Å—Ç—Ä–æ–∫–∏, –∞ —á–∏—Å—Ç–∏–º –∏—Ö —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏/–ø–æ–∏—Å–∫–µ.
                allLinks = normalizedText.split('\n')
                                .map(link => link.trim())
                                .filter(link => link.length > 0);

                allLinks = [...new Set(allLinks)];
                
                statusMessage.textContent = `–ë–∞–∑–∞ Telegram –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –í—Å–µ–≥–æ —é–∑–µ—Ä–æ–≤: ${allLinks.length}.`;
            } catch (error) {
                statusMessage.textContent = `–û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–∞–∑—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è —Ñ–∞–π–ª–∞ "${TELEGRAM_DB_FILE}" –∏ –∫–æ–Ω—Å–æ–ª—å.`;
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –±–∞–∑—ã:", error);
            }
        }

        // === –§—É–Ω–∫—Ü–∏–∏ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–í–°–ï –°–°–´–õ–ö–ò –°–†–ê–ó–£) ===

        function displayLinks(links) {
            resultsContainer.innerHTML = ''; 

            if (links.length === 0) {
                statusMessage.textContent = '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.';
                return;
            }
            
            // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—á–∏—Å—Ç–∫—É –ø–µ—Ä–µ–¥ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
            links.forEach(rawLink => {
                const cleanUser = extractCleanUsername(rawLink);

                const linkElement = document.createElement('a');
                
                // –°–æ–∑–¥–∞–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π href
                linkElement.href = formatLink(cleanUser); 
                linkElement.target = '_blank';
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —á–∏—Å—Ç—ã–π —é–∑–µ—Ä–Ω–µ–π–º —Å @
                linkElement.textContent = `@${cleanUser}`; 
                
                resultsContainer.appendChild(linkElement);
            });
        }

        function resetState() {
            resultsContainer.innerHTML = '';
            statusMessage.textContent = '';
        }

        // === –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ö–Ω–æ–ø–æ–∫ ===

        searchButton.addEventListener('click', () => {
            const query = searchInput.value.toLowerCase().trim().replace(/^@/, ''); 
            if (query.length === 0) {
                statusMessage.textContent = '–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞.';
                return;
            }

            resetState();
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ —á–∏—Å—Ç–æ–π –≤–µ—Ä—Å–∏–∏ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const foundResults = allLinks.filter(rawLink => {
                const cleanUser = extractCleanUsername(rawLink).toLowerCase();
                return cleanUser.includes(query);
            });

            displayLinks(foundResults);
            statusMessage.textContent = `–ù–∞–π–¥–µ–Ω–æ ${foundResults.length} —é–∑–µ—Ä–æ–≤ –ø–æ –∑–∞–ø—Ä–æ—Å—É "${query}".`;
        });
        
        randomButton.addEventListener('click', () => {
            resetState();
            
            if (allLinks.length === 0) {
                statusMessage.textContent = '–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—É—Å—Ç–∞ –∏–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞.';
                return;
            }

            const shuffledLinks = shuffleArray([...allLinks]);
            const randomLinks = shuffledLinks.slice(0, RANDOM_COUNT);

            displayLinks(randomLinks);
            statusMessage.textContent = `–í—ã–≤–µ–¥–µ–Ω–æ ${randomLinks.length} —Å–ª—É—á–∞–π–Ω—ã—Ö —é–∑–µ—Ä–æ–≤.`;
        });

        loadDatabase();
    </script>
</body>
</html>
